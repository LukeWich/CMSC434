<!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Shopping List Tab</title>
        <link href="./resources/css/lists.css" type="text/css" rel="stylesheet">
        <link href="./resources/css/styles.css" type="text/css" rel="stylesheet">
    </head>
    
    <body>
        <div class="device">
            <div id = "header">Shopping List</div>
            <div id = "item-background">
                <div id="item-list">
                    <input type="text" id="input-item" placeholder="Add a new item...">
                    <button id="add-button" onclick="addTask()">Add</button>
                </div>

                <div id="list-container">
                    <ul id="food-list"></ul>
                </div>

                <button id="add-to-kitchen-button" onclick="addListToKitchen()">Add Checked Items to Kitchen</button>
            </div>

            <!-- Back icon -->
            <a href="lists_home.html">
                <img class='profile-icon' height="75" src="resources/images/back_icon.png">
            </a>

            <!-- Nav Bar html -->
            <div class="icon-bar">
                <a href="kitchen.html">
                    <img src="resources/images/kitchen_icon.png" height="75">
                </a>
                <a href="lists_home.html" class="active">
                    <img src="resources/images/lists_icon.png" height="75">
                </a>
                <a href="recipies.html">
                    <img src="resources/images/recipies_icon.png" height="75">
                </a>
            </div>
            <!-- End Nav Bar html -->
        </div>
    </body>
    
    <script>
        // Dict where each key corresponds to a different shopping list, values are list of items
        listContents = {
            "Greg's Birthday": {"Cake": false, "Candles": false, "Hamburgers": false, "Hamburger Buns": false, "Balloons": false},
            "Weekly Shopping": {"Bread": false, "Ground Beef": false, "Milk": false, "Grapes": false, "Broccoli": false, "Pasta": false}
        };

        var url_string = window.location;
        var url = new URL(url_string);
        var listName = url.searchParams.get("list");

        window.onload = function() {
            
            if (!localStorage.getItem("listContents")) {
                localStorage.setItem("listContents", JSON.stringify(listContents));
            }
            storage = localStorage.getItem("listContents");
            listContents = storage ? JSON.parse(storage) : [];
            
            // Adds all items in the list to the list
            if (listName in listContents) {
                for (const [name, checked] of Object.entries(listContents[listName])) {
                    createListElement(name, checked);
                }

            // create new list if it doesn't already exist
            } else {
                listContents[listName] = {};
                localStorage.setItem('listContents', JSON.stringify(listContents));
            }

            // title of the page
            var listTitle = document.getElementById('header-food-list');
            listTitle.innerHTML = listName + ' List';
        };
        
        // create the html for list
        function createListElement(name, checked) {
            var taskList = document.getElementById('food-list');
            var li = document.createElement('li');
            li.setAttribute('id', name);
            li.innerHTML = name + " <span class='close' onClick='deleteTask(this); event.stopPropagation();'>x</span>";
            li.onclick = function() {
                li.classList.toggle('done');
                // update the local storage
                storage = localStorage.getItem("listContents");
                listContents = storage ? JSON.parse(storage) : [];
                listContents[listName][name] = !listContents[listName][name]
                localStorage.setItem('listContents', JSON.stringify(listContents));
            };
            // set it the item is checked or not
            if (checked) {
                li.classList.toggle('done');
            }

            taskList.appendChild(li);
        }

        // adds item to local storage and creates html for it
        function addItem(item) {
            // save the new list to localstorage
            const storage = localStorage.getItem("listContents");
            const temp = storage ? JSON.parse(storage) : [];
            temp[listName][item] = false;
            localStorage.setItem("listContents", JSON.stringify(temp));
            
            createListElement(item, false);
        }


        function addTask() {
            var taskInput = document.getElementById('input-item');
            var taskText = taskInput.value.trim();

            if (taskText === "") {
                alert("Please enter a food item.");
                return;
            }

            addItem(taskText);

            taskInput.value = "";
        }

        function deleteTask(button) {
            var li = button.parentNode;
            li.parentNode.removeChild(li);
            itemToRemove = button.parentNode.id;

            // remove the new list to localstorage
            const storage = localStorage.getItem("listContents");
            const temp = storage ? JSON.parse(storage) : [];
            delete temp[listName][itemToRemove];
            localStorage.setItem("listContents", JSON.stringify(temp));
        }
    </script>



</html>