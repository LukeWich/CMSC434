<!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Title</title>
        <link href="./resources/css/recipies.css" type="text/css" rel="stylesheet">
        <link href="./resources/css/styles.css" type="text/css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    </head>
    
    <body>
        <div class="device">
            <!-- Beginning of the Recipe page Body -->
            <h1>Recipes</h1>
            <div id="inputContainer">
            <label for="recipeName"><p>Enter Recipe Name:</p></label>
            <input type="text" id="recipeName" placeholder="e.g. Banana Cake"><button id="searchButton">Search</button>
            </div>

            <div id="recipeDisplay"></div>

            <!-- Profile icon and page -->
            <img class='profile-icon' onclick="toggleSidePanel()" height="75" src="resources/images/profile_icon.png">
            <div class="profile-panel" id="profile-panel" style="display: none">
                <a class="profile-heading" href="profile.html" style="top: 10px">
                    <img style="position:absolute; height:100px; left:20px" src="resources/images/profile_icon.png">
                    <b class="user-name">User's Name</b>
                    <small>View Profile</small>
                </a>

                <a href="settings.html" style="top: 150px">
                    <img class="panel-images" src="resources/images/settings_icon.png">
                    <b>Settings</b>
                </a>

                <a href="" style="top: 225px">
                    <img class="panel-images" src="resources/images/plus_icon.png">
                    <b>Add Users</b>
                </a>

                <a href="help.html" style="top: 300px">
                    <img class="panel-images" src="resources/images/question_icon.png">
                    <b>Help</b>
                </a>

                <a href="" style="top: 375px">
                    <img class="panel-images" src="resources/images/logout_icon.png">
                    <b>Log Out</b>
                </a>

                <img class="close-icon" onclick="toggleSidePanel()" height="50" src="resources/images/close_icon.png">
            </div>
            <script>
                function toggleSidePanel() {
                    var x = document.getElementById('profile-panel');
                    var recipeInput = document.getElementById('recipeName');
                    var searchButton = document.getElementById('searchButton');
                    var recipeLabel = document.querySelector('label[for="recipeName"]');
                    if (x.style.display === "none") {
                        x.style.display = 'block';
                        // Hide recipe input elements
                        recipeInput.style.display = 'none';
                        searchButton.style.display = 'none';
                        recipeLabel.style.display = 'none';
                    } else {
                        x.style.display = 'none';
                        // Show recipe input elements
                        recipeInput.style.display = 'block';
                        searchButton.style.display = 'block';
                        recipeLabel.style.display = 'block'
                    }
                }
            </script>
            <!--- End Profile side panel -->
            
            <!-- Nav Bar html -->
            <div class="icon-bar">
                <a href="kitchen.html">
                    <img src="resources/images/kitchen_icon.png" height="75">
                </a>
                <a href="lists_home.html">
                    <img src="resources/images/lists_icon.png" height="75">
                </a>
                <a href="recipies.html" class="active">
                    <img src="resources/images/recipies_icon.png" height="75">
                </a>
            </div>
            <!-- End Nav Bar html -->

            <script>
                let recipeDictionary = {};

                // Function to fetch and parse the CSV file
                function loadCSV() {
                    fetch('resources/texts/recipes.csv')
                    .then(response => response.text())
                    .then(csvText => {
                        Papa.parse(csvText, {
                        header: true,
                        skipEmptyLines: true,
                        complete: (results) => {
                  
                            recipeDictionary = createRecipeDictionary(results.data);
                            // Display the recipe dictionary for testing
                            //displayData(recipeDictionary);
                        }
                        });
                    })
                    .catch(error => console.error('Error fetching the CSV file:', error));
                }
                //Creates a dictionary of recipes
                function createRecipeDictionary(data) {
                    const dictionary = {};
                    data.forEach(recipe => {
                        const title = recipe.Title;
                        dictionary[title] = {
                            Directions: recipe.Directions,
                            Ingredients: []
                        };
                        for (let i = 1; i <= 20; i++) {
                            const ingredientKey = `Ingredient0${i}`;
                            const quantityKey = `Quantity0${i}`;
                            const unitKey = `Unit0${i}`;
               
                            if (recipe[ingredientKey]) {
                                // Getting rid of Jan
                                let quantity = recipe[quantityKey];
                                if (quantity && quantity.includes('2-Jan')) {
                                    quantity = quantity.replace('2-Jan', '1/2').trim();
                                } else if(quantity && quantity.includes('3-Jan')) {
                                    quantity = quantity.replace('3-Jan', '1/3').trim();
                         } else if (quantity && quantity.includes('4-Jan')) {
                                    quantity = quantity.replace('4-Jan', '1/4').trim();
                                }
                                if (!quantity) {
                                    quantity = '1';
                                }
                                // Add the ingredient details
                                dictionary[title].Ingredients.push({
                                    Quantity: quantity,
                                    Unit: recipe[unitKey],
                                    Name: recipe[ingredientKey]
                                });
                            }
                        }   
                    });
                    return dictionary;
                }

                function displayRecipe() {
                    const recipeName = document.getElementById('recipeName').value;
                    const recipeDisplay = document.getElementById('recipeDisplay');
                    const recipe = recipeDictionary[recipeName];
                    if (recipe) {
                    // Format the recipe details for display
                        const ingredientsList = recipe.Ingredients.map(ingredient =>
                        `${ingredient.Quantity} ${ingredient.Unit} of ${ingredient.Name}`).join('\n');
                        const recipeDetails = `Title: ${recipeName}\nDirections: ${recipe.Directions}\nIngredients:\n${ingredientsList}`;
                        recipeDisplay.textContent = recipeDetails;
                    } else {
                    recipeDisplay.textContent = 'Recipe not found.';
                    }
                }
                // Function to display the recipe dictionary
                //function displayData(dictionary) {
                //const outputElement = document.getElementById('output');
                //outputElement.textContent = JSON.stringify(dictionary, null, 2); // Pretty print the JSON data
                //}

                // Load the CSV file on page load
                window.onload = () => {
                    loadCSV();
                    document.getElementById('searchButton').addEventListener('click', displayRecipe);
                };
            </script>
        </div>
    </body>
</html>
